<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Shadow Ledger - Offline First Cash Management">
    <title>Shadow Ledger 2026</title>
    <style>
        /* * 2026 MODERN CSS STACK 
         * Features: OKLCH Colors, CSS Variables, Native Nesting, Container Queries
         */
        @layer reset, base, components, utilities;

        @layer reset {
            *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
            body { line-height: 1.6; -webkit-font-smoothing: antialiased; }
            input, button, select { font: inherit; }
        }

        @layer base {
            :root {
                /* OKLCH Color Gamut for 2026 Vibrancy */
                --brand-hue: 245; 
                --color-bg: oklch(18% 0.01 var(--brand-hue));
                --color-surface: oklch(25% 0.02 var(--brand-hue));
                --color-surface-glass: oklch(25% 0.02 var(--brand-hue) / 0.7);
                --color-text-primary: oklch(98% 0 0);
                --color-text-secondary: oklch(75% 0 0);
                
                --color-accent: oklch(65% 0.2 var(--brand-hue)); /* Electric Blue */
                --color-success: oklch(65% 0.18 145); /* Neon Green */
                --color-danger: oklch(60% 0.2 25);   /* Alert Red */
                
                --radius-sm: 8px;
                --radius-md: 16px;
                --radius-lg: 24px;
                
                --shadow-glass: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
                --font-sans: 'Inter', system-ui, -apple-system, sans-serif;
            }

            body {
                font-family: var(--font-sans);
                background-color: var(--color-bg);
                color: var(--color-text-primary);
                padding: 2rem;
                /* Subtle grain texture overlay */
                background-image: radial-gradient(circle at top left, rgba(255,255,255,0.05), transparent 40%);
            }
        }

        @layer components {
            .app-container {
                max-width: 800px;
                margin: 0 auto;
                display: flex;
                flex-direction: column;
                gap: 2rem;
            }

            /* Glassmorphism Card */
            .glass-card {
                background: var(--color-surface-glass);
                backdrop-filter: blur(12px);
                -webkit-backdrop-filter: blur(12px);
                border: 1px solid rgba(255, 255, 255, 0.08);
                border-radius: var(--radius-md);
                padding: 2rem;
                box-shadow: var(--shadow-glass);
                transition: transform 0.2s ease;
                
                &:hover {
                    border-color: rgba(255, 255, 255, 0.15);
                }
            }

            .header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 1rem;
                
                h1 { font-size: 2rem; font-weight: 800; letter-spacing: -0.05em; }
            }

            /* Modern Inputs */
            .input-group {
                display: grid;
                gap: 0.5rem;
                margin-bottom: 1rem;
                
                label {
                    font-size: 0.75rem;
                    text-transform: uppercase;
                    letter-spacing: 0.1em;
                    color: var(--color-text-secondary);
                    font-weight: 600;
                }
                
                input, select {
                    background: rgba(0,0,0,0.2);
                    border: 1px solid rgba(255,255,255,0.1);
                    color: white;
                    padding: 0.75rem 1rem;
                    border-radius: var(--radius-sm);
                    transition: all 0.2s;
                    
                    &:focus {
                        outline: none;
                        border-color: var(--color-accent);
                        box-shadow: 0 0 0 2px rgba(100, 100, 255, 0.2);
                    }
                }
            }

            /* Interactive Buttons */
            .btn {
                width: 100%;
                padding: 1rem;
                border: none;
                border-radius: var(--radius-sm);
                font-weight: 700;
                cursor: pointer;
                display: flex;
                justify-content: center;
                gap: 0.5rem;
                transition: transform 0.1s;
                
                &:active { transform: scale(0.98); }
                
                &.primary { background: var(--color-accent); color: white; }
                &.secondary { background: rgba(255,255,255,0.1); color: white; }
            }

            /* Transaction List with Animation */
            .transaction-list {
                list-style: none;
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
            }

            .transaction-item {
                display: grid;
                grid-template-columns: auto 1fr auto auto;
                gap: 1rem;
                align-items: center;
                padding: 1rem;
                background: rgba(255,255,255,0.03);
                border-radius: var(--radius-sm);
                /* Entry Animation */
                animation: slideIn 0.3s cubic-bezier(0.2, 0.9, 0.3, 1) forwards;
                
                .t-icon { font-size: 1.5rem; }
                
                .t-details {
                    display: flex;
                    flex-direction: column;
                    .t-desc { font-weight: 600; }
                    .t-meta { font-size: 0.8rem; color: var(--color-text-secondary); }
                }

                .t-amount { font-family: monospace; font-size: 1.1rem; font-weight: 700; }
                
                .t-delete {
                    opacity: 0;
                    color: var(--color-danger);
                    cursor: pointer;
                    transition: opacity 0.2s;
                }
                
                &:hover .t-delete { opacity: 1; }
            }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive */
        @media (max-width: 600px) {
            body { padding: 1rem; }
            .header h1 { font-size: 1.5rem; }
        }

        /* Print Layer */
        @media print {
            body { background: white; color: black; }
            .glass-card { box-shadow: none; border: 1px solid #ccc; backdrop-filter: none; }
            .no-print { display: none; }
        }
    </style>
</head>
<body>

    <main class="app-container" id="app">
        
        <header class="header">
            <h1>ðŸŒ‘ Shadow Ledger</h1>
            <button class="btn secondary" style="width:auto" onclick="app.toggleReportMode()">
                <span id="viewToggleBtn">ðŸ“„ View Report</span>
            </button>
        </header>

        <div id="dashboardView">
            <section class="glass-card" style="margin-bottom: 2rem;">
                <div style="display: flex; justify-content: space-between; text-align: center;">
                    <div>
                        <div style="font-size: 0.8rem; text-transform: uppercase; opacity: 0.7">Collected</div>
                        <div style="font-size: 1.5rem; color: var(--color-success)" id="displayIn">0.00</div>
                    </div>
                    <div>
                        <div style="font-size: 0.8rem; text-transform: uppercase; opacity: 0.7">Net Position</div>
                        <div style="font-size: 2rem; font-weight: 800;" id="displayNet">0.00</div>
                    </div>
                    <div>
                        <div style="font-size: 0.8rem; text-transform: uppercase; opacity: 0.7">Deposited</div>
                        <div style="font-size: 1.5rem; color: var(--color-danger)" id="displayOut">0.00</div>
                    </div>
                </div>
            </section>

            <section class="glass-card">
                <div class="input-group">
                    <label>Type</label>
                    <select id="inputType">
                        <option value="COLLECT">ðŸ“¥ Collection (In)</option>
                        <option value="DEPOSIT">ðŸ“¤ Deposit (Out)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Description</label>
                    <input type="text" id="inputDesc" placeholder="Client Name or Reference">
                </div>
                <div class="input-group">
                    <label>Amount</label>
                    <input type="number" id="inputAmt" placeholder="0.00" step="0.01">
                </div>
                <div class="input-group">
                    <label>Receipt Image</label>
                    <input type="file" id="inputFile" accept="image/*">
                </div>
                <button class="btn primary" onclick="app.addTransaction()">Save Entry</button>
            </section>

            <h3 style="margin-top:2rem; margin-bottom:1rem; opacity:0.6;">Recent Activity</h3>
            <ul class="transaction-list" id="txList"></ul>
        </div>

        <div id="reportView" class="glass-card" style="display:none">
            <h2 style="color: black; margin-bottom: 1rem;">Official Settlement Report</h2>
            <table style="width:100%; color:black; border-collapse: collapse;">
                <thead>
                    <tr style="border-bottom: 2px solid #333;">
                        <th style="text-align:left; padding:8px;">Date</th>
                        <th style="text-align:left;">Desc</th>
                        <th style="text-align:right;">Amount</th>
                    </tr>
                </thead>
                <tbody id="reportTableBody"></tbody>
            </table>
            <div style="text-align:right; color:black; font-size:1.5rem; margin-top:20px; font-weight:bold;" id="reportTotal"></div>
        </div>

    </main>

    <script type="module">
        /**
         * 2026 ARCHITECTURE: SERVICES & REACTIVE STATE
         */

        // Service: Handles Data Persistence
        const StorageService = {
            KEY: 'shadow_ledger_v2026',
            get() { return JSON.parse(localStorage.getItem(this.KEY)) || []; },
            set(data) { localStorage.setItem(this.KEY, JSON.stringify(data)); }
        };

        // Service: Handles File encoding (Base64)
        const FileService = {
            toBase64: (file) => new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            })
        };

        // Reactive State Engine
        const State = {
            transactions: StorageService.get(),
            viewMode: 'dashboard', // or 'report'
            
            // "Computed Properties"
            get totals() {
                return this.transactions.reduce((acc, t) => {
                    const val = parseFloat(t.amount);
                    if (t.type === 'COLLECT') acc.in += val;
                    else acc.out += val;
                    return acc;
                }, { in: 0, out: 0 });
            }
        };

        // The PROXY intercepts data changes and triggers UI updates automatically
        const reactiveState = new Proxy(State, {
            set(target, property, value) {
                target[property] = value;
                if (property === 'transactions') StorageService.set(value);
                RenderEngine.update();
                return true;
            }
        });

        // View Logic
        const RenderEngine = {
            init() { this.update(); },
            
            update() {
                // Toggle Views
                const isDash = reactiveState.viewMode === 'dashboard';
                document.getElementById('dashboardView').style.display = isDash ? 'block' : 'none';
                document.getElementById('reportView').style.display = isDash ? 'none' : 'block';
                document.getElementById('viewToggleBtn').innerText = isDash ? 'ðŸ“„ View Report' : 'â† Back to Dashboard';

                if (isDash) this.renderDashboard();
                else this.renderReport();
            },

            renderDashboard() {
                const { in: tIn, out: tOut } = reactiveState.totals;
                document.getElementById('displayIn').innerText = tIn.toFixed(2);
                document.getElementById('displayOut').innerText = tOut.toFixed(2);
                document.getElementById('displayNet').innerText = (tIn - tOut).toFixed(2);

                const listEl = document.getElementById('txList');
                listEl.innerHTML = reactiveState.transactions.slice().reverse().map((t, idx) => `
                    <li class="transaction-item">
                        <div class="t-icon">${t.type === 'COLLECT' ? 'ðŸ“¥' : 'ðŸ“¤'}</div>
                        <div class="t-details">
                            <span class="t-desc">${t.desc}</span>
                            <span class="t-meta">${t.date} ${t.image ? 'â€¢ ðŸ“Ž Receipt' : ''}</span>
                        </div>
                        <div class="t-amount" style="color: ${t.type === 'COLLECT' ? 'var(--color-success)' : 'var(--color-text-primary)'}">
                            ${parseFloat(t.amount).toFixed(2)}
                        </div>
                        <div class="t-delete" onclick="window.app.deleteTx(${reactiveState.transactions.length - 1 - idx})">âœ•</div>
                    </li>
                `).join('');
            },

            renderReport() {
                const tbody = document.getElementById('reportTableBody');
                let total = 0;
                tbody.innerHTML = reactiveState.transactions.map(t => {
                    const val = parseFloat(t.amount);
                    if (t.type === 'COLLECT') total += val; else total -= val;
                    return `
                        <tr>
                            <td style="padding:8px; border-bottom:1px solid #eee">${t.date}</td>
                            <td style="padding:8px; border-bottom:1px solid #eee">${t.desc}</td>
                            <td style="padding:8px; border-bottom:1px solid #eee; text-align:right">${val.toFixed(2)}</td>
                        </tr>
                    `;
                }).join('');
                document.getElementById('reportTotal').innerText = `Net: ${total.toFixed(2)}`;
            }
        };

        // Application Controller (Exposed to Window for HTML event binding)
        window.app = {
            async addTransaction() {
                const type = document.getElementById('inputType').value;
                const desc = document.getElementById('inputDesc').value;
                const amt = parseFloat(document.getElementById('inputAmt').value);
                const fileInput = document.getElementById('inputFile');

                if (!desc || !amt) return alert('Please fill details');

                let imgData = null;
                if (fileInput.files[0]) {
                    // Limit: 500KB
                    if(fileInput.files[0].size > 500000) return alert('Image too large (Max 500KB)');
                    imgData = await FileService.toBase64(fileInput.files[0]);
                }

                // Create new array reference to trigger Proxy
                reactiveState.transactions = [...reactiveState.transactions, {
                    id: crypto.randomUUID(),
                    date: new Date().toLocaleDateString('en-CA'),
                    type, desc, amount: amt, image: imgData
                }];

                // Reset Form
                document.getElementById('inputDesc').value = '';
                document.getElementById('inputAmt').value = '';
                fileInput.value = '';
            },

            deleteTx(realIndex) {
                if(!confirm('Delete item?')) return;
                const newArr = [...reactiveState.transactions];
                newArr.splice(realIndex, 1);
                reactiveState.transactions = newArr;
            },

            toggleReportMode() {
                reactiveState.viewMode = reactiveState.viewMode === 'dashboard' ? 'report' : 'dashboard';
                RenderEngine.update();
            }
        };

        // Boot
        RenderEngine.init();
    </script>
</body>
</html>